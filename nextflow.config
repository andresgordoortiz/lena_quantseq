// Profile config for CLIP cluster
params {
    config_profile_description = 'CLIP cluster profile'
    config_profile_contact = 'Andres Ortiz'
}

singularity {
    enabled = true
    autoMounts = true
}

// Global process configuration
process {
    // Executor configuration
    executor = 'slurm'
    queue = 'c'
    
    // Default QoS - simple, no closures
    clusterOptions = '--qos=c_short'
    
    // Error handling with retries
    errorStrategy = { task.exitStatus in [1, 135, 255, 143, 137, 104, 134, 139] ? 'retry' : 'finish' }
    maxRetries = 3
    
    // Resource scaling - SAFE VERSION (no self-reference)
    memory = { 12.GB * task.attempt }
    time = { 4.h * task.attempt }
    
    // Exponential backoff between retries
    backOffStrategy = 'exponential'
    
    // GPU partition
    withLabel: 'gpu' {
        queue = 'g'
        clusterOptions = '--gres=gpu:1 --qos=g_short'
    }
    
    // High-memory partition
    withLabel: 'highmem' {
        queue = 'm'
        clusterOptions = '--qos=m_short'
    }
}